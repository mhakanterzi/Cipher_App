<Window x:Class="CipherApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:CipherApp"
        xmlns:vm="clr-namespace:CipherApp.ViewModels"
        xmlns:views="clr-namespace:CipherApp.Views"
        mc:Ignorable="d"
        Title="Åžifreleme AtÃ¶lyesi" Height="600" Width="1000" Background="{StaticResource Brush.Bg1}">
    <Window.Resources>
        <!-- Use global styles from App.xaml -->
    </Window.Resources>
    <Window.DataContext>
        <vm:MainViewModel />
    </Window.DataContext>
    <Grid Margin="0">
        <Grid.RowDefinitions>
            <RowDefinition Height="100"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Grid Grid.Row="0" Background="{StaticResource Brush.Bg1}">
            <Rectangle Fill="{StaticResource Grad.Header}" Opacity="0.25"/>
            <StackPanel Orientation="Horizontal" Margin="16" VerticalAlignment="Center">
                <TextBlock Text="ðŸ”" FontSize="32" Margin="0,0,8,0"/>
                <StackPanel>
                    <TextBlock Text="Åžifreleme AtÃ¶lyesi" FontSize="24" FontWeight="Bold" Foreground="{StaticResource Brush.Text}"/>
                    <TextBlock Text="Klasik ÅŸifreler, kolay kullanÄ±m, adÄ±m adÄ±m anlatÄ±m" Foreground="{StaticResource Brush.Muted}"/>
                </StackPanel>
            </StackPanel>
        </Grid>

        <!-- Body -->
        <Grid Grid.Row="1" Margin="16">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="300"/>
            <ColumnDefinition Width="16"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Sidebar -->
        <Border Background="{StaticResource Brush.Surface}" CornerRadius="12" Padding="12" >
            <StackPanel>
                <TextBlock Text="Gezinme" Foreground="{StaticResource Brush.Text}" FontSize="18" FontWeight="Bold"/>
                <ListBox ItemsSource="{Binding MenuItems}" SelectedItem="{Binding SelectedMenu}"
                         Background="{StaticResource Brush.Card}" BorderBrush="{StaticResource Brush.Card}" Foreground="{StaticResource Brush.Text}"
                         ItemContainerStyle="{StaticResource NavItem}" Margin="0,8,0,8">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{Binding Icon}" Margin="6,0,6,0"/>
                                <StackPanel>
                                    <TextBlock Text="{Binding Title}"/>
                                    <TextBlock Text="{Binding Subtitle}" Foreground="{StaticResource Brush.Muted}" FontSize="11"/>
                                </StackPanel>
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <TextBlock Text="Åžifreler" Foreground="{StaticResource Brush.Text}" FontSize="16" FontWeight="Bold"/>
                <ListBox x:Name="CipherListBox" ItemsSource="{Binding CipherList}" SelectedItem="{Binding SelectedCipher}" Margin="0,8,0,0"
                         Background="{StaticResource Brush.Card}" BorderBrush="{StaticResource Brush.Card}" Foreground="{StaticResource Brush.Text}"
                         ItemContainerStyle="{StaticResource NavItem}">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Name}" Padding="8"/>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <Separator Margin="0,12"/>
                <Button Content="Yeni Soru" Command="{Binding NewQuizCommand}" Style="{StaticResource Btn.Pill}" Background="{StaticResource Brush.Secondary}"/>
            </StackPanel>
        </Border>

        <!-- Spacer -->
        <Grid Grid.Column="1"/>

        <!-- Content -->
        <Border x:Name="ContentPanel" Grid.Column="2" Style="{StaticResource Card}" Opacity="0.0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <TextBlock Text="{Binding SelectedCipher.Name}" FontSize="22" FontWeight="Bold" Foreground="{StaticResource Brush.Text}"/>

                <!-- If React (wwwroot/index.html) is present, show ReactView as main content, otherwise WPF tabs -->
                <Grid Grid.Row="1">
                    <views:ReactView Visibility="{Binding IsReactAvailable, Converter={StaticResource BoolToVis}}"/>
                    <TabControl Background="{StaticResource Brush.Surface}" BorderBrush="{StaticResource Brush.Surface}" ItemContainerStyle="{StaticResource TabItem.Underline}"
                                SelectedIndex="{Binding SelectedTabIndex}" Visibility="{Binding IsReactAvailable, Converter={StaticResource NotBoolToVis}}">
                    <!-- AtÃ¶lye Tab -->
                    <TabItem Header="AtÃ¶lye">
                        <Grid Margin="8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Margin="0,0,12,0">
                                <TextBlock Text="AÃ§Ä±klama" Foreground="{StaticResource Brush.Muted}"/>
                                <TextBlock TextWrapping="Wrap" Foreground="{StaticResource Brush.Text}" Margin="0,4,0,12" Text="{Binding Explanation}"/>

                                <TextBlock Text="Anahtar" Foreground="{StaticResource Brush.Muted}"/>
                                <TextBox Style="{StaticResource Input.Dark}" Text="{Binding KeyInput, UpdateSourceTrigger=PropertyChanged}"/>
                                <TextBlock Foreground="{StaticResource Brush.Muted}" FontSize="12" Margin="0,2,0,12" Text="{Binding KeyHint}"/>

                                <TextBlock Text="Girdi" Foreground="{StaticResource Brush.Muted}"/>
                                <TextBox Style="{StaticResource Input.Dark}" Text="{Binding Plaintext, UpdateSourceTrigger=PropertyChanged}" AcceptsReturn="True" Height="140"/>

                                <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                    <Button Content="Åžifrele" Command="{Binding EncryptCommand}" Style="{StaticResource Btn.Pill}" Background="{StaticResource Grad.Primary}" Margin="0,0,8,0"/>
                                    <Button Content="Ã‡Ã¶z" Command="{Binding DecryptCommand}" Style="{StaticResource Btn.Pill}" Background="{StaticResource Grad.Primary}" Margin="0,0,8,0"/>
                                    <Button Content="Anahtar Ãœret" Command="{Binding RandomizeKeyCommand}" Style="{StaticResource Btn.Ghost}"/>
                                </StackPanel>

                                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                                    <Button Content="Ã–rnek Metin" Command="{Binding InsertExampleCommand}" Style="{StaticResource Btn.Ghost}" Margin="0,0,8,0"/>
                                    <Button Content="Ã‡Ä±ktÄ±yÄ± Kopyala" Command="{Binding CopyOutputCommand}" Style="{StaticResource Btn.Ghost}"/>
                                </StackPanel>
                            </StackPanel>

                            <StackPanel Grid.Column="1">
                                <TextBlock Text="Ã‡Ä±ktÄ±" Foreground="{StaticResource Brush.Muted}"/>
                                <Border Style="{StaticResource Card}" Background="{StaticResource Brush.Card}" Padding="8">
                                    <TextBox Text="{Binding Output}" AcceptsReturn="True" Background="{StaticResource Brush.Card}" Foreground="{StaticResource Brush.Text}" BorderThickness="0"/>
                                </Border>
                            </StackPanel>
                        </Grid>
                    </TabItem>

                    <!-- AdÄ±m AdÄ±m Tab -->
                    <TabItem Header="AdÄ±m AdÄ±m">
                        <Grid Margin="8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="2*"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Margin="0,0,12,0">
                                <TextBlock Text="Anahtar" Foreground="{StaticResource Brush.Muted}"/>
                                <TextBox Style="{StaticResource Input.Dark}" Text="{Binding KeyInput, UpdateSourceTrigger=PropertyChanged}"/>
                                <TextBlock Foreground="{StaticResource Brush.Muted}" FontSize="12" Margin="0,2,0,12" Text="{Binding KeyHint}"/>
                                <TextBlock Text="Metin" Foreground="{StaticResource Brush.Muted}"/>
                                <TextBox Style="{StaticResource Input.Dark}" Text="{Binding Plaintext, UpdateSourceTrigger=PropertyChanged}" AcceptsReturn="True" Height="120"/>

                                <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                    <Button Content="Åžifreleme AdÄ±mlarÄ±" Command="{Binding GenerateEncryptStepsCommand}" Style="{StaticResource Btn.Pill}" Margin="0,0,8,0"/>
                                    <Button Content="Ã‡Ã¶zme AdÄ±mlarÄ±" Command="{Binding GenerateDecryptStepsCommand}" Style="{StaticResource Btn.Pill}"/>
                                </StackPanel>

                                <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                    <Button Content="Ä°leri" Command="{Binding NextStepCommand}" Style="{StaticResource Btn.Ghost}"/>
                                    <Button Content="SÄ±fÄ±rla" Command="{Binding ResetStepsCommand}" Style="{StaticResource Btn.Ghost}" Margin="8,0,0,0"/>
                                </StackPanel>

                                <!-- Playfair board preview when applicable -->
                                <Border Style="{StaticResource Card}" Margin="0,12,0,0" Visibility="{Binding SelectedCipher, Converter={StaticResource BoolToVis}}">
                                    <StackPanel>
                                        <TextBlock Text="Playfair Tablosu" Foreground="{StaticResource Brush.Muted}"/>
                                        <TextBlock Text="{Binding PlayfairBoard}" Foreground="{StaticResource Brush.Text}"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>

                            <ScrollViewer Grid.Column="1">
                                <ItemsControl ItemsSource="{Binding Steps}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="{StaticResource Brush.Card}" CornerRadius="8" Padding="10" Margin="0,0,0,8">
                                                <Border.Triggers>
                                                    <EventTrigger RoutedEvent="FrameworkElement.Loaded">
                                                        <BeginStoryboard>
                                                            <Storyboard>
                                                                <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:0.25"/>
                                                                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)" From="8" To="0" Duration="0:0:0.25"/>
                                                            </Storyboard>
                                                        </BeginStoryboard>
                                                    </EventTrigger>
                                                </Border.Triggers>
                                                <Border.RenderTransform>
                                                    <TranslateTransform Y="0"/>
                                                </Border.RenderTransform>
                                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                    <Border Style="{StaticResource Badge}" Margin="0,0,8,0">
                                                        <TextBlock Text="{Binding Index}"/>
                                                    </Border>
                                                    <TextBlock Foreground="{StaticResource Brush.Text}" TextWrapping="Wrap" VerticalAlignment="Center" Text="{Binding Text}"/>
                                                </StackPanel>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </Grid>
                    </TabItem>

                    <!-- Soru Tab -->
                    <TabItem Header="Soru">
                        <Grid Margin="8">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                <Button Content="Yeni Soru" Command="{Binding NewQuizCommand}" Style="{StaticResource Btn.Pill}" Background="{StaticResource Brush.Secondary}"/>
                                <Button Content="CevabÄ± GÃ¶ster" Command="{Binding ShowAnswerCommand}" Style="{StaticResource Btn.Pill}" Background="{StaticResource Brush.Danger}" Margin="8,0,0,0"/>
                            </StackPanel>
                            <Border Style="{StaticResource Card}" Grid.Row="1">
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                        <TextBlock Text="Åžifre:" Foreground="{StaticResource Brush.Muted}"/>
                                        <TextBlock Text="{Binding CurrentQuestion.CipherName}" Foreground="{StaticResource Brush.Text}" Margin="6,0,0,0"/>
                                    </StackPanel>
                                    <TextBlock Text="Åžifreli Metin" Foreground="{StaticResource Brush.Muted}"/>
                                    <TextBlock Text="{Binding CurrentQuestion.Ciphertext}" TextWrapping="Wrap" Foreground="#FDE68A"/>
                                </StackPanel>
                            </Border>
                        </Grid>
                    </TabItem>

                    </TabControl>
                </Grid>
            </Grid>
        </Border>
        </Grid>

        <!-- Toast Notification -->
        <Border Grid.Row="1" HorizontalAlignment="Right" VerticalAlignment="Top" Margin="0,24,24,0" Background="{StaticResource Brush.Surface}" CornerRadius="8" Padding="10" Opacity="0"
                Visibility="{Binding ShowToast, Converter={StaticResource BoolToVis}}">
            <Border.Triggers>
                <EventTrigger RoutedEvent="Border.Loaded">
                    <BeginStoryboard Storyboard="{StaticResource Stb.FadeIn}"/>
                </EventTrigger>
            </Border.Triggers>
            <StackPanel Orientation="Horizontal" RenderTransformOrigin="0.5,0.5">
                <TextBlock Text="ðŸ””" Margin="0,0,6,0"/>
                <TextBlock Text="{Binding ToastText}" Foreground="{StaticResource Brush.Text}"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>
